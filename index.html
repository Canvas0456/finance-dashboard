<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Kaiwalya’s Finance Dashboard</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
  --bg:#faf7f2;
  --card:#ffffff;
  --text:#2b2b2b;
  --muted:#7a7a7a;
  --accent:#4a6cf7;
  --danger:#e5533d;
  --success:#2e9e6f;
}

body{
  margin:0;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto;
  background:var(--bg);
  color:var(--text);
}

header{
  position:fixed;
  top:0;
  left:0;
  right:0;
  background:var(--bg);
  padding:16px 24px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  z-index:10;
  border-bottom:1px solid #e6e1d8;
}

h1{
  margin:0;
  font-size:20px;
  font-weight:600;
}

.date{
  font-size:14px;
  color:var(--muted);
}

main{
  padding:96px 20px 40px;
  max-width:1200px;
  margin:auto;
}

.kpis{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
  gap:16px;
}

.card{
  background:var(--card);
  border-radius:14px;
  padding:18px;
  box-shadow:0 6px 18px rgba(0,0,0,0.04);
}

.card h3{
  margin:0;
  font-size:13px;
  color:var(--muted);
}

.card p{
  margin:8px 0 0;
  font-size:22px;
  font-weight:600;
}

.bar-wrap{
  margin-top:24px;
}

.bar{
  height:12px;
  background:#e6e1d8;
  border-radius:8px;
  overflow:hidden;
}

.bar-fill{
  height:100%;
  background:linear-gradient(90deg,var(--accent),#7aa2ff);
  width:0%;
}

.bar-label{
  display:flex;
  justify-content:space-between;
  font-size:12px;
  margin-top:6px;
  color:var(--muted);
}

.section{
  margin-top:40px;
}

canvas{
  background:var(--card);
  border-radius:14px;
  padding:16px;
}
</style>
</head>

<body>

<header>
  <h1>Kaiwalya’s Finance Dashboard</h1>
  <div class="date" id="today"></div>
</header>

<main>

<!-- KPI CARDS -->
<div class="kpis">
  <div class="card"><h3>Total Balance</h3><p id="kpi-balance">—</p></div>
  <div class="card"><h3>Expenses</h3><p id="kpi-expense">—</p></div>
  <div class="card"><h3>Budget Used</h3><p id="kpi-budget">—</p></div>
  <div class="card"><h3>Net Savings</h3><p id="kpi-savings">—</p></div>
</div>

<!-- BUDGET BAR -->
<div class="bar-wrap card">
  <div class="bar">
    <div class="bar-fill" id="budget-bar"></div>
  </div>
  <div class="bar-label">
    <span id="budget-used">Used: —%</span>
    <span id="budget-rem">Remaining: ₹—</span>
  </div>
</div>

<!-- TREND -->
<div class="section">
  <canvas id="trendChart" height="120"></canvas>
</div>

</main>

<script>
const SHEET_ID = "1ApiV5dmKYycVw2IEnVKkNHY2ssLcOZZ1v1slU57UqM0";

document.getElementById("today").innerText =
  new Date().toLocaleDateString("en-IN",{day:"numeric",month:"short",year:"numeric"});

function fetchSheet(sheet){
  const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?sheet=${sheet}`;
  return fetch(url)
    .then(r=>r.text())
    .then(t=>JSON.parse(t.substring(47).slice(0,-2)).table.rows);
}

/* KPIs */
fetchSheet("Dashboard_KPIs_Month").then(rows=>{
  const map={};
  rows.forEach(r=>{
    if(r.c[0] && r.c[1]) map[r.c[0].v]=r.c[1].v;
  });

  document.getElementById("kpi-balance").innerText = "₹"+map["Total Balance (All Accounts)"];
  document.getElementById("kpi-expense").innerText = "₹"+map["Current Month Expenses"];
  document.getElementById("kpi-savings").innerText = "₹"+map["Current Month Net Savings"];

  const used = map["Budget Used %"]*100;
  document.getElementById("kpi-budget").innerText = used.toFixed(1)+"%";
  document.getElementById("budget-bar").style.width = used+"%";
  document.getElementById("budget-used").innerText = "Used: "+used.toFixed(1)+"%";
  document.getElementById("budget-rem").innerText =
    "Remaining: ₹"+map["Budget Remaining"];
});

/* Trend Chart */
fetchSheet("Category_Monthly_Actuals").then(rows=>{
  const labels=[], values=[];
  rows.forEach(r=>{
    labels.push(r.c[1].v);
    values.push(r.c[2].v);
  });

  new Chart(document.getElementById("trendChart"),{
    type:"line",
    data:{
      labels,
      datasets:[{
        data:values,
        borderColor:"#4a6cf7",
        tension:.35,
        fill:false
      }]
    },
    options:{
      plugins:{legend:{display:false}},
      scales:{
        x:{grid:{display:false}},
        y:{grid:{display:false}}
      }
    }
  });
});
</script>

</body>
</html>
