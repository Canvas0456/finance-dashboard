<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Personal Finance Dashboard</title>

<script src="https://www.gstatic.com/charts/loader.js"></script>

<style>
body{
  margin:0;
  font-family:system-ui,-apple-system;
  background:#020617;
  color:#e5e7eb
}
h1{text-align:center;margin:12px}
.section{padding:14px}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:12px}
.card{background:#020617;border-radius:14px;padding:14px;box-shadow:inset 0 0 0 1px #1e293b}
.card h3{font-size:12px;color:#9ca3af;margin:0 0 6px}
.card p{font-size:20px;margin:0;font-weight:600}
.toggle{display:flex;gap:6px;justify-content:center;margin:10px}
.toggle button{
  padding:6px 12px;border-radius:10px;
  background:#020617;color:#e5e7eb;border:1px solid #1e293b
}
.toggle button.active{background:#2563eb;border-color:#2563eb}
.chart{background:#020617;border-radius:14px;padding:10px;margin-top:10px}
select{width:100%;padding:8px;background:#020617;color:#e5e7eb;border:1px solid #1e293b;border-radius:8px}
</style>
</head>

<body>

<h1>ğŸ“Š Finance Dashboard</h1>

<!-- MAIN TOGGLE -->
<div class="toggle">
  <button onclick="setMode('WEEKLY')" id="btnW">Weekly</button>
  <button onclick="setMode('MONTHLY')" id="btnM" class="active">Monthly</button>
  <button onclick="setMode('YTD')" id="btnY">YTD</button>
</div>

<!-- QUICK RANGE -->
<div class="toggle">
  <button onclick="setRange(7)">Last 7</button>
  <button onclick="setRange(30)">Last 30</button>
  <button onclick="setRange(90)">Last 90</button>
</div>

<div class="section">
  <select id="weekSelect" style="display:none"></select>
  <select id="monthSelect"></select>
</div>

<!-- KPI -->
<div class="section">
  <div class="grid">
    <div class="card"><h3>Income</h3><p id="kInc">â€“</p></div>
    <div class="card"><h3>Expense</h3><p id="kExp">â€“</p></div>
    <div class="card"><h3>Net</h3><p id="kNet">â€“</p></div>
    <div class="card"><h3>Budget Burn %</h3><p id="kBurn">â€“</p></div>
  </div>
</div>

<!-- CHARTS -->
<div class="section">
  <h3>ğŸ“ˆ Trend</h3>
  <div id="trend" class="chart" style="height:260px"></div>
</div>

<div class="section">
  <h3>ğŸ© Distribution</h3>
  <div id="donut" class="chart" style="height:260px"></div>
</div>

<div class="section">
  <h3>ğŸ“Š MoM Comparison</h3>
  <div id="mom" class="chart" style="height:260px"></div>
</div>

<script>
google.charts.load("current",{packages:["corechart"]});
google.charts.setOnLoadCallback(init);

const SHEET_ID="1ApiV5dmKYycVw2IEnVKkNHY2ssLcOZZ1v1slU57UqM0";
let MODE="MONTHLY", RANGE=null;

function gviz(sheet){
  return fetch(`https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?sheet=${sheet}`)
    .then(r=>r.text())
    .then(t=>JSON.parse(t.substr(47).slice(0,-2)));
}

function setMode(m){
  MODE=m;
  btnW.classList.remove("active");
  btnM.classList.remove("active");
  btnY.classList.remove("active");
  document.getElementById("btn"+m[0]).classList.add("active");
  weekSelect.style.display = m==="WEEKLY"?"block":"none";
  monthSelect.style.display = m==="MONTHLY"?"block":"none";
  refresh();
}

function setRange(d){ RANGE=d; refresh(); }

async function init(){
  loadMonthSlicer();
  refresh();
}

async function loadMonthSlicer(){
  const d=await gviz("Finance_Monthly_Summary");
  monthSelect.innerHTML="";
  d.table.rows.forEach(r=>{
    const m=r.c[0].v;
    const o=document.createElement("option");
    o.value=m;o.text=m;
    monthSelect.appendChild(o);
  });
  monthSelect.onchange=refresh;
}

async function refresh(){
  drawKPIs();
  drawTrend();
  drawDonut();
  drawMoM();
}

async function drawKPIs(){
  if(MODE==="MONTHLY"){
    const d=await gviz("Finance_Monthly_Summary");
    const r=d.table.rows.find(x=>x.c[0].v===monthSelect.value);
    if(!r)return;
    kInc.innerText=r.c[1].v;
    kExp.innerText=r.c[2].v;
    kNet.innerText=r.c[4].v;
  }
  if(MODE==="YTD"){
    const d=await gviz("Finance_Monthly_Summary");
    let i=0,e=0;
    d.table.rows.forEach(r=>{i+=Number(r.c[1].v);e+=Number(r.c[2].v)});
    kInc.innerText=i;kExp.innerText=e;kNet.innerText=i-e;
  }
}

async function drawTrend(){
  const d=await gviz("Finance_Monthly_Summary");
  const data=new google.visualization.DataTable();
  data.addColumn("string","Period");
  data.addColumn("number","Expense");
  d.table.rows.forEach(r=>data.addRow([r.c[0].v,Number(r.c[2].v)]));
  new google.visualization.LineChart(trend).draw(data,{backgroundColor:"transparent",legend:"none"});
}

async function drawDonut(){
  const d=await gviz("Category_Monthly_Actuals");
  const data=new google.visualization.DataTable();
  data.addColumn("string","Category");
  data.addColumn("number","Amount");
  d.table.rows.forEach(r=>{
    if(Number(r.c[2].v)>0)data.addRow([r.c[1].v,Number(r.c[2].v)]);
  });
  if(data.getNumberOfRows()>0)
    new google.visualization.PieChart(donut).draw(data,{pieHole:0.6,backgroundColor:"transparent"});
}

async function drawMoM(){
  const d=await gviz("Finance_Monthly_Summary");
  const data=new google.visualization.DataTable();
  data.addColumn("string","Month");
  data.addColumn("number","Expense");
  d.table.rows.slice(-6).forEach(r=>data.addRow([r.c[0].v,Number(r.c[2].v)]));
  new google.visualization.ColumnChart(mom).draw(data,{backgroundColor:"transparent",legend:"none"});
}
</script>

</body>
</html>
