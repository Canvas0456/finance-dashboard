<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Kaiwalya ‚Ä¢ Financial Intelligence</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://www.gstatic.com/charts/loader.js"></script>

<style>
:root{
  --bg:#020617;
  --card:#020617;
  --border:#1e293b;
  --green:#16a34a;
  --yellow:#eab308;
  --red:#dc2626;
  --blue:#2563eb;
  --text:#e5e7eb;
  --muted:#94a3b8;
}
*{box-sizing:border-box}
body{
  margin:0;
  background:radial-gradient(circle at top,#0f172a,#020617);
  font-family:system-ui,-apple-system;
  color:var(--text);
}
h1{text-align:center;margin:16px 0 6px;font-size:22px}
.sub{text-align:center;color:var(--muted);font-size:12px}
.section{padding:14px}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:12px}
.card{
  background:linear-gradient(145deg,#020617,#020617);
  border-radius:16px;
  padding:14px;
  box-shadow:inset 0 0 0 1px var(--border)
}
.card h3{font-size:11px;margin:0 0 6px;color:var(--muted)}
.card p{font-size:20px;margin:0;font-weight:600}
.kpi{display:flex;justify-content:space-between;align-items:center}
.badge{font-size:11px;padding:4px 8px;border-radius:999px}
.safe{background:#064e3b}
.warn{background:#78350f}
.risk{background:#7f1d1d}
.chart{margin-top:10px;padding:10px;background:var(--card);border-radius:16px}
.alert{margin-top:10px;padding:12px;border-radius:14px;font-size:13px}
.alert.red{background:#7f1d1d}
.alert.yellow{background:#78350f}
.alert.green{background:#064e3b}
</style>
</head>
<body>
<h1>üí∏ Financial Intelligence</h1>
<div class="sub">Live ‚Ä¢ Predictive ‚Ä¢ Actionable</div>

<div class="section">
  <div class="grid">
    <div class="card"><h3>Total Balance</h3><p id="kTotal">‚Äì</p></div>
    <div class="card"><h3>Income (MoM)</h3><p id="kIncome">‚Äì</p></div>
    <div class="card"><h3>Expenses (MoM)</h3><p id="kExpense">‚Äì</p></div>
    <div class="card"><h3>Net Savings</h3><p id="kNet">‚Äì</p></div>
    <div class="card"><h3>MoM Change</h3><p id="kMoM">‚Äì</p></div>
    <div class="card"><h3>Cash Runway</h3><p id="kRunway">‚Äì</p></div>
  </div>
</div>

<div class="section">
  <h3>üè¶ Account Balances</h3>
  <div id="accounts" class="grid"></div>
</div>

<div class="section">
  <h3>üìä Spending Overview</h3>
  <div id="donut" class="chart" style="height:280px"></div>
</div>

<div class="section">
  <h3>üìà Monthly Trend</h3>
  <div id="trend" class="chart" style="height:260px"></div>
</div>

<div class="section">
  <h3>üß† AI Insights</h3>
  <div id="insights"></div>
</div>
<script>
google.charts.load("current",{packages:["corechart"]});
google.charts.setOnLoadCallback(init);

const SHEET_ID="1ApiV5dmKYycVw2IEnVKkNHY2ssLcOZZ1v1slU57UqM0";

function gviz(sheet){
  return fetch(`https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?sheet=${sheet}`)
    .then(r=>r.text())
    .then(t=>JSON.parse(t.substr(47).slice(0,-2)));
}

async function init(){
  loadKPIs();
  loadAccounts();
  loadDonut();
  loadTrend();
  loadAI();
}
  async function loadKPIs(){
  const d=await gviz("Dashboard_KPIs");
  const m={};
  d.table.rows.forEach(r=>m[r.c[0].v]=Number(r.c[1]?.v||0));
  kTotal.innerText="‚Çπ"+m["Total Balance (All Accounts)"];
  kIncome.innerText="‚Çπ"+m["Current Month Income"];
  kExpense.innerText="‚Çπ"+m["Current Month Expenses"];
  kNet.innerText="‚Çπ"+m["Current Month Net Savings"];
  kMoM.innerText=(m["MoM %"]||0)+"%";
  kRunway.innerText=(m["Cash Runway (Days)"]||"‚Äì")+" days";
}

async function loadAccounts(){
  const d=await gviz("Account_Balances_Live");
  accounts.innerHTML="";
  d.table.rows.forEach(r=>{
    const bal=Number(r.c[4].v);
    let cls="safe";
    if(bal<0) cls="risk";
    else if(bal<2000) cls="warn";
    accounts.innerHTML+=`
      <div class="card kpi">
        <div>
          <h3>${r.c[0].v}</h3>
          <p>‚Çπ${bal}</p>
        </div>
        <span class="badge ${cls}">
          ${cls==="safe"?"OK":cls==="warn"?"LOW":"CRITICAL"}
        </span>
      </div>`;
  });
}

async function loadDonut(){
  const d=await gviz("Category_Monthly_Actuals");
  const data=new google.visualization.DataTable();
  data.addColumn("string","Category");
  data.addColumn("number","Amount");
  d.table.rows.forEach(r=>{
    if(Number(r.c[2].v)>0)
      data.addRow([r.c[1].v,Number(r.c[2].v)]);
  });
  if(data.getNumberOfRows()>0)
    new google.visualization.PieChart(donut)
    .draw(data,{pieHole:0.6,backgroundColor:"transparent"});
}

async function loadTrend(){
  const d=await gviz("Finance_Monthly_Summary");
  const data=new google.visualization.DataTable();
  data.addColumn("string","Month");
  data.addColumn("number","Expenses");
  d.table.rows.forEach(r=>data.addRow([r.c[0].v,Number(r.c[2].v)]));
  new google.visualization.LineChart(trend)
    .draw(data,{backgroundColor:"transparent",legend:"none"});
}

async function loadAI(){
  const d=await gviz("AI_Insights");
  insights.innerHTML="";
  d.table.rows.forEach(r=>{
    if(!r.c[0].v) return;
    let cls="green";
    if(r.c[1].v==="HIGH") cls="red";
    else if(r.c[1].v==="MEDIUM") cls="yellow";
    insights.innerHTML+=`
      <div class="alert ${cls}">
        <strong>${r.c[2].v}</strong><br>
        ${r.c[3].v}<br>
        <em>${r.c[4].v}</em>
      </div>`;
  });
}
</script>
</body>
</html>
