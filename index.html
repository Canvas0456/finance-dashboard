<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=1"
  />
  <title>Kaiwalyaâ€™s Finance Dashboard</title>

  <!-- Font -->
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
    rel="stylesheet"
  />

  <style>
    /* ===============================
       THEME VARIABLES
    =============================== */
    :root {
      --bg-main: #0b0e14;
      --bg-glass: rgba(255, 255, 255, 0.06);
      --bg-glass-strong: rgba(255, 255, 255, 0.12);

      --text-primary: #ffffff;
      --text-secondary: rgba(255, 255, 255, 0.7);
      --text-muted: rgba(255, 255, 255, 0.45);

      --accent: #4f7cff;
      --accent-soft: rgba(79, 124, 255, 0.25);

      --success: #2ecc71;
      --warning: #f1c40f;
      --danger: #ff6b6b;

      --radius-lg: 20px;
      --radius-md: 14px;

      --blur: blur(18px);
      --shadow: 0 12px 40px rgba(0, 0, 0, 0.35);
    }

    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont;
      background: radial-gradient(
          circle at top,
          rgba(79, 124, 255, 0.15),
          transparent 40%
        ),
        var(--bg-main);
      color: var(--text-primary);
    }

    /* ===============================
       GLASS UTILITY
    =============================== */
    .glass {
      background: var(--bg-glass);
      backdrop-filter: var(--blur);
      -webkit-backdrop-filter: var(--blur);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow);
    }

    /* ===============================
       FIXED HEADER
    =============================== */
    header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 100;
      padding: 18px 20px;
      background: linear-gradient(
        to bottom,
        rgba(11, 14, 20, 0.85),
        rgba(11, 14, 20, 0.55)
      );
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      border-bottom: 1px solid rgba(255, 255, 255, 0.08);
    }

    .header-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .title-block h1 {
      font-size: 20px;
      font-weight: 600;
      margin: 0;
      letter-spacing: -0.2px;
    }

    .title-block p {
      margin: 4px 0 0;
      font-size: 12px;
      color: var(--text-secondary);
    }

    .date-block {
      text-align: right;
      font-size: 12px;
      color: var(--text-muted);
    }

    .date-block .month {
      font-size: 13px;
      font-weight: 500;
      color: var(--text-secondary);
    }

    /* ===============================
       PAGE CONTAINER
    =============================== */
    main {
      padding: 110px 16px 120px;
      max-width: 1100px;
      margin: auto;
    }

    /* ===============================
       RESPONSIVE
    =============================== */
    @media (min-width: 768px) {
      header {
        padding: 20px 32px;
      }

      .title-block h1 {
        font-size: 22px;
      }

      main {
        padding: 120px 24px 120px;
      }
    }
  </style>
</head>

<body>
  <!-- ===============================
       HEADER
  =============================== -->
  <header>
    <div class="header-row">
      <div class="title-block">
        <h1>Kaiwalyaâ€™s Finance Dashboard</h1>
        <p>Clarity over cash. Control over chaos.</p>
      </div>

      <div class="date-block">
        <div id="todayDate"></div>
        <div class="month" id="selectedMonth"></div>
      </div>
    </div>
  </header>

  <!-- ===============================
       MAIN WRAPPER (CONTENT COMES NEXT)
  =============================== -->
  <main id="app">
    <!-- PART 2 onwards will be pasted here -->
  </main>

  <!-- ===============================
       DATE + MONTH LOGIC
  =============================== -->
  <script>
    const now = new Date();

    document.getElementById("todayDate").innerText =
      now.toLocaleDateString("en-IN", {
        day: "2-digit",
        month: "short",
        year: "numeric"
      });

    document.getElementById("selectedMonth").innerText =
      now.toLocaleDateString("en-IN", {
        month: "long",
        year: "numeric"
      });
  </script>


<!-- ===============================
     MODE TOGGLE (MONTH / YTD)
=============================== -->
<section class="glass" style="padding:16px; margin-bottom:22px;">
  <div class="mode-toggle">
    <button id="btnMonth" class="toggle-btn active">Month</button>
    <button id="btnYTD" class="toggle-btn">YTD</button>
  </div>

  <div class="mode-caption">
    Viewing: <span id="modeLabel">Current Month</span>
  </div>
</section>

<style>
  /* ===============================
     TOGGLE STYLES
  =============================== */
  .mode-toggle {
    display: flex;
    background: rgba(255,255,255,0.08);
    border-radius: 999px;
    padding: 6px;
    gap: 6px;
  }

  .toggle-btn {
    flex: 1;
    border: none;
    padding: 10px 0;
    border-radius: 999px;
    background: transparent;
    color: var(--text-secondary);
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.25s ease;
  }

  .toggle-btn.active {
    background: linear-gradient(
      135deg,
      var(--accent),
      #6b8cff
    );
    color: #fff;
    box-shadow: 0 6px 20px rgba(79,124,255,0.45);
  }

  .mode-caption {
    margin-top: 10px;
    font-size: 12px;
    color: var(--text-muted);
    text-align: center;
  }
</style>

<script>
  /* ===============================
     GLOBAL DASHBOARD STATE
  =============================== */
  let dashboardMode = "MONTH"; // MONTH | YTD

  const btnMonth = document.getElementById("btnMonth");
  const btnYTD = document.getElementById("btnYTD");
  const modeLabel = document.getElementById("modeLabel");
  const selectedMonth = document.getElementById("selectedMonth");

  function setMode(mode) {
    dashboardMode = mode;

    btnMonth.classList.toggle("active", mode === "MONTH");
    btnYTD.classList.toggle("active", mode === "YTD");

    if (mode === "MONTH") {
      modeLabel.innerText = "Current Month";
      selectedMonth.innerText = new Date().toLocaleDateString("en-IN", {
        month: "long",
        year: "numeric"
      });
    } else {
      modeLabel.innerText = "Year to Date";
      selectedMonth.innerText =
        "YTD " +
        new Date().getFullYear();
    }

    // ðŸ”” Future parts will listen to this
    document.dispatchEvent(
      new CustomEvent("dashboardModeChanged", {
        detail: { mode: dashboardMode }
      })
    );
  }

  btnMonth.onclick = () => setMode("MONTH");
  btnYTD.onclick = () => setMode("YTD");
</script>

  <!-- ===============================
     KPI CARDS
=============================== -->
<section class="kpi-grid">

  <div class="glass kpi-card">
    <div class="kpi-label">Available Balance</div>
    <div class="kpi-value" id="kpiBalance">â‚¹â€”</div>
  </div>

  <div class="glass kpi-card">
    <div class="kpi-label">Total Expenses</div>
    <div class="kpi-value danger" id="kpiExpenses">â‚¹â€”</div>
  </div>

  <div class="glass kpi-card">
    <div class="kpi-label">Budget Burn</div>
    <div class="kpi-value warning" id="kpiBurn">â€”%</div>
  </div>

  <div class="glass kpi-card">
    <div class="kpi-label">Budget Remaining</div>
    <div class="kpi-value success" id="kpiRemaining">â‚¹â€”</div>
  </div>

</section>

<style>
  /* ===============================
     KPI GRID
  =============================== */
  .kpi-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 14px;
    margin-bottom: 26px;
  }

  @media (min-width: 768px) {
    .kpi-grid {
      grid-template-columns: repeat(4, 1fr);
    }
  }

  .kpi-card {
    padding: 16px;
    text-align: left;
    transition: transform 0.25s ease;
  }

  .kpi-card:active {
    transform: scale(0.98);
  }

  .kpi-label {
    font-size: 12px;
    color: var(--text-muted);
    margin-bottom: 6px;
  }

  .kpi-value {
    font-size: 22px;
    font-weight: 600;
    letter-spacing: -0.3px;
  }

  .kpi-value.success {
    color: var(--success);
  }

  .kpi-value.warning {
    color: var(--warning);
  }

  .kpi-value.danger {
    color: var(--danger);
  }
</style>

<script>
  /* ===============================
     KPI DATA HANDLER
     (Sheet wiring happens here)
  =============================== */

  function animateValue(el, value, prefix = "", suffix = "") {
    el.style.opacity = 0;
    setTimeout(() => {
      el.innerText = `${prefix}${value}${suffix}`;
      el.style.opacity = 1;
    }, 200);
  }

  function loadKPIs(mode) {
    /**
     * TEMP DATA (will be replaced by Google Sheets fetch)
     * DO NOT hardcode logic here later
     */
    const mockMonth = {
      balance: 22668,
      expenses: 12447,
      burn: 48.3,
      remaining: 13545
    };

    const mockYTD = {
      balance: 22668,
      expenses: 68240,
      burn: 62.9,
      remaining: 40210
    };

    const data = mode === "MONTH" ? mockMonth : mockYTD;

    animateValue(
      document.getElementById("kpiBalance"),
      data.balance.toLocaleString("en-IN"),
      "â‚¹"
    );

    animateValue(
      document.getElementById("kpiExpenses"),
      data.expenses.toLocaleString("en-IN"),
      "â‚¹"
    );

    animateValue(
      document.getElementById("kpiBurn"),
      data.burn.toFixed(1),
      "",
      "%"
    );

    animateValue(
      document.getElementById("kpiRemaining"),
      data.remaining.toLocaleString("en-IN"),
      "â‚¹"
    );
  }

  /* Initial load */
  loadKPIs(dashboardMode);

  /* React to toggle */
  document.addEventListener("dashboardModeChanged", e => {
    loadKPIs(e.detail.mode);
  });
</script>

  <!-- ===============================
     BUDGET UTILISATION
=============================== -->
<section class="glass budget-card">

  <div class="budget-header">
    <div>
      <div class="budget-title">Budget Utilisation</div>
      <div class="budget-sub">
        <span id="budgetModeLabel">Current Month</span> overview
      </div>
    </div>

    <div class="budget-metrics">
      <div>
        <span class="metric-label">Used</span>
        <span class="metric-value warning" id="budgetUsedPct">â€”%</span>
      </div>
      <div>
        <span class="metric-label">Remaining</span>
        <span class="metric-value success" id="budgetRemainPct">â€”%</span>
      </div>
    </div>
  </div>

  <!-- BAR -->
  <div class="budget-bar">
    <div class="budget-bar-used" id="budgetBarUsed"></div>
  </div>

  <!-- VALUES -->
  <div class="budget-values">
    <div>
      <span class="muted">Spent</span>
      <strong id="budgetSpent">â‚¹â€”</strong>
    </div>
    <div>
      <span class="muted">Total Budget</span>
      <strong id="budgetTotal">â‚¹â€”</strong>
    </div>
  </div>

</section>

<style>
  /* ===============================
     BUDGET CARD
  =============================== */
  .budget-card {
    padding: 18px;
    margin-bottom: 28px;
  }

  .budget-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 14px;
    gap: 12px;
  }

  .budget-title {
    font-size: 15px;
    font-weight: 600;
  }

  .budget-sub {
    font-size: 12px;
    color: var(--text-muted);
    margin-top: 2px;
  }

  .budget-metrics {
    display: flex;
    gap: 14px;
    font-size: 13px;
  }

  .metric-label {
    display: block;
    font-size: 11px;
    color: var(--text-muted);
  }

  .metric-value {
    font-weight: 600;
  }

  /* ===============================
     BAR
  =============================== */
  .budget-bar {
    width: 100%;
    height: 14px;
    background: rgba(255,255,255,0.1);
    border-radius: 999px;
    overflow: hidden;
    margin: 10px 0 14px;
  }

  .budget-bar-used {
    height: 100%;
    width: 0%;
    background: linear-gradient(
      90deg,
      var(--warning),
      #ff9f43
    );
    border-radius: 999px;
    transition: width 0.6s ease;
  }

  /* ===============================
     VALUES
  =============================== */
  .budget-values {
    display: flex;
    justify-content: space-between;
    font-size: 13px;
  }
</style>

<script>
  /* ===============================
     BUDGET DATA HANDLER
  =============================== */

  function loadBudget(mode) {
    /**
     * TEMP DATA (replace with Google Sheets logic later)
     * Structure is FINAL â€“ only values will change
     */
    const monthData = {
      spent: 12447,
      total: 26000
    };

    const ytdData = {
      spent: 68240,
      total: 108500
    };

    const data = mode === "MONTH" ? monthData : ytdData;

    const usedPct = data.total
      ? (data.spent / data.total) * 100
      : 0;

    const remainPct = 100 - usedPct;

    document.getElementById("budgetModeLabel").innerText =
      mode === "MONTH" ? "Current Month" : "Year to Date";

    document.getElementById("budgetUsedPct").innerText =
      usedPct.toFixed(1) + "%";

    document.getElementById("budgetRemainPct").innerText =
      remainPct.toFixed(1) + "%";

    document.getElementById("budgetSpent").innerText =
      "â‚¹" + data.spent.toLocaleString("en-IN");

    document.getElementById("budgetTotal").innerText =
      "â‚¹" + data.total.toLocaleString("en-IN");

    document.getElementById("budgetBarUsed").style.width =
      Math.min(usedPct, 100) + "%";
  }

  /* Initial load */
  loadBudget(dashboardMode);

  /* React to toggle */
  document.addEventListener("dashboardModeChanged", e => {
    loadBudget(e.detail.mode);
  });
</script>

  <!-- ===============================
     SPENDING BEHAVIOUR
=============================== -->
<section class="glass spending-card">

  <div class="spending-header">
    <div class="spending-title">Spending Behaviour</div>
    <div class="spending-sub">
      Last 7 days Â· <span id="spendingModeLabel">Current Month</span>
    </div>
  </div>

  <div id="spendingList" class="spending-list">
    <!-- rows injected -->
  </div>

</section>

<style>
  /* ===============================
     SPENDING CARD
  =============================== */
  .spending-card {
    padding: 18px;
    margin-bottom: 28px;
  }

  .spending-header {
    margin-bottom: 12px;
  }

  .spending-title {
    font-size: 15px;
    font-weight: 600;
  }

  .spending-sub {
    font-size: 12px;
    color: var(--text-muted);
    margin-top: 2px;
  }

  /* ===============================
     SPENDING LIST
  =============================== */
  .spending-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
    margin-top: 8px;
  }

  .spend-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 12px;
    border-radius: var(--radius-md);
    background: rgba(255,255,255,0.05);
  }

  .spend-left {
    display: flex;
    flex-direction: column;
  }

  .spend-date {
    font-size: 13px;
    font-weight: 500;
  }

  .spend-cat {
    font-size: 12px;
    color: var(--text-muted);
    margin-top: 2px;
  }

  .spend-amt {
    font-weight: 600;
    font-size: 14px;
    color: var(--danger);
  }
</style>

<script>
  /* ===============================
     SPENDING DATA HANDLER
  =============================== */

  function formatDate(d) {
    return d.toLocaleDateString("en-IN", {
      day: "2-digit",
      month: "short"
    });
  }

  function loadSpending(mode) {
    /**
     * TEMP DATA (replace with Txn_Clean fetch later)
     * Sorted: most recent first
     */
    const mockTxns = [
      { date: "2026-01-04", cat: "Utilities", amt: 1260 },
      { date: "2026-01-03", cat: "Local Travel", amt: 835 },
      { date: "2026-01-02", cat: "Personal Loan EMI", amt: 3702 },
      { date: "2026-01-02", cat: "Shopping / Misc", amt: 282 },
      { date: "2026-01-01", cat: "Transfer to Mom", amt: 6000 },
      { date: "2026-01-01", cat: "Groceries & Daily Food", amt: 130 },
      { date: "2025-12-31", cat: "Eating Out / Office Food", amt: 116 }
    ];

    const list = document.getElementById("spendingList");
    const label = document.getElementById("spendingModeLabel");

    list.innerHTML = "";
    label.innerText = mode === "MONTH" ? "Current Month" : "Year to Date";

    mockTxns.slice(0, 7).forEach(txn => {
      const row = document.createElement("div");
      row.className = "spend-row";

      const d = new Date(txn.date);

      row.innerHTML = `
        <div class="spend-left">
          <div class="spend-date">${formatDate(d)}</div>
          <div class="spend-cat">${txn.cat}</div>
        </div>
        <div class="spend-amt">â‚¹${txn.amt.toLocaleString("en-IN")}</div>
      `;

      list.appendChild(row);
    });
  }

  /* Initial load */
  loadSpending(dashboardMode);

  /* React to toggle */
  document.addEventListener("dashboardModeChanged", e => {
    loadSpending(e.detail.mode);
  });
</script>

  <!-- ===============================
     EXPENSE TREND
=============================== -->
<section class="glass trend-card">

  <div class="trend-header">
    <div class="trend-title">Expense Trend</div>
    <div class="trend-sub" id="trendSubtitle">
      Weekly spend Â· Current Month
    </div>
  </div>

  <!-- SVG CHART -->
  <svg
    id="trendChart"
    viewBox="0 0 320 120"
    preserveAspectRatio="none"
    style="width:100%; height:160px;"
  >
    <path
      id="trendPath"
      d=""
      fill="none"
      stroke="url(#trendGradient)"
      stroke-width="3"
      stroke-linecap="round"
    />

    <defs>
      <linearGradient id="trendGradient" x1="0" y1="0" x2="1" y2="0">
        <stop offset="0%" stop-color="#4f7cff" />
        <stop offset="100%" stop-color="#6b8cff" />
      </linearGradient>
    </defs>
  </svg>

  <!-- LABELS -->
  <div id="trendLabels" class="trend-labels"></div>

</section>

<style>
  /* ===============================
     TREND CARD
  =============================== */
  .trend-card {
    padding: 18px;
    margin-bottom: 30px;
  }

  .trend-header {
    margin-bottom: 10px;
  }

  .trend-title {
    font-size: 15px;
    font-weight: 600;
  }

  .trend-sub {
    font-size: 12px;
    color: var(--text-muted);
    margin-top: 2px;
  }

  /* ===============================
     LABELS
  =============================== */
  .trend-labels {
    display: flex;
    justify-content: space-between;
    font-size: 11px;
    color: var(--text-muted);
    margin-top: 6px;
  }
</style>

<script>
  /* ===============================
     TREND DATA HANDLER
  =============================== */

  function drawTrend(data) {
    const width = 320;
    const height = 120;
    const padding = 10;

    const maxVal = Math.max(...data.map(d => d.value), 1);

    const points = data.map((d, i) => {
      const x =
        padding +
        (i / (data.length - 1 || 1)) * (width - padding * 2);
      const y =
        height -
        padding -
        (d.value / maxVal) * (height - padding * 2);
      return { x, y };
    });

    let path = `M ${points[0].x} ${points[0].y}`;
    points.slice(1).forEach(p => {
      path += ` L ${p.x} ${p.y}`;
    });

    document.getElementById("trendPath").setAttribute("d", path);

    // Labels
    const labelBox = document.getElementById("trendLabels");
    labelBox.innerHTML = "";
    data.forEach(d => {
      const span = document.createElement("span");
      span.innerText = d.label;
      labelBox.appendChild(span);
    });
  }

  function loadTrend(mode) {
    let data;
    const subtitle = document.getElementById("trendSubtitle");

    if (mode === "MONTH") {
      subtitle.innerText = "Weekly spend Â· Current Month";

      // Week-wise mock data (replace with Txn_Clean logic later)
      data = [
        { label: "W1", value: 3200 },
        { label: "W2", value: 4100 },
        { label: "W3", value: 2850 },
        { label: "W4", value: 2300 },
        { label: "W5", value: 900 }
      ];
    } else {
      subtitle.innerText = "Monthly spend Â· Year to Date";

      // Month-wise mock data
      data = [
        { label: "Jan", value: 18500 },
        { label: "Feb", value: 20100 },
        { label: "Mar", value: 17600 },
        { label: "Apr", value: 19400 },
        { label: "May", value: 16800 }
      ];
    }

    drawTrend(data);
  }

  /* Initial load */
  loadTrend(dashboardMode);

  /* React to toggle */
  document.addEventListener("dashboardModeChanged", e => {
    loadTrend(e.detail.mode);
  });
</script>

  <!-- ===============================
     EXPENSE CATEGORIES
=============================== -->
<section class="glass category-card">

  <div class="category-header">
    <div class="category-title">Expense Categories</div>
    <div class="category-sub">
      <span id="categoryModeLabel">Current Month</span> Â· highest impact first
    </div>
  </div>

  <div id="categoryList" class="category-list">
    <!-- rows injected -->
  </div>

</section>

<style>
  /* ===============================
     CATEGORY CARD
  =============================== */
  .category-card {
    padding: 18px;
    margin-bottom: 30px;
  }

  .category-header {
    margin-bottom: 12px;
  }

  .category-title {
    font-size: 15px;
    font-weight: 600;
  }

  .category-sub {
    font-size: 12px;
    color: var(--text-muted);
    margin-top: 2px;
  }

  /* ===============================
     CATEGORY LIST
  =============================== */
  .category-list {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin-top: 10px;
  }

  .cat-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 12px;
    border-radius: var(--radius-md);
    background: rgba(255,255,255,0.05);
  }

  .cat-left {
    display: flex;
    flex-direction: column;
  }

  .cat-name {
    font-size: 13px;
    font-weight: 500;
  }

  .cat-share {
    font-size: 11px;
    color: var(--text-muted);
    margin-top: 2px;
  }

  .cat-amt {
    font-size: 14px;
    font-weight: 600;
    color: var(--danger);
  }
</style>

<script>
  /* ===============================
     CATEGORY DATA HANDLER
  =============================== */

  function loadCategories(mode) {
    /**
     * TEMP DATA (replace with Category_Monthly_Actuals later)
     * Sorted: highest spend first
     */
    const monthData = [
      { cat: "Transfer to Mom", amt: 6000 },
      { cat: "Personal Loan EMI", amt: 3702 },
      { cat: "Utilities", amt: 1260 },
      { cat: "Local Travel", amt: 835 },
      { cat: "Shopping / Misc", amt: 282 },
      { cat: "Groceries & Daily Food", amt: 130 }
    ];

    const ytdData = [
      { cat: "Transfer to Mom", amt: 72000 },
      { cat: "Personal Loan EMI", amt: 44424 },
      { cat: "Utilities", amt: 15820 },
      { cat: "Local Travel", amt: 12140 },
      { cat: "Groceries & Daily Food", amt: 8960 },
      { cat: "Shopping / Misc", amt: 7420 }
    ];

    const data = mode === "MONTH" ? monthData : ytdData;
    const total = data.reduce((s, d) => s + d.amt, 0) || 1;

    const list = document.getElementById("categoryList");
    const label = document.getElementById("categoryModeLabel");

    list.innerHTML = "";
    label.innerText = mode === "MONTH" ? "Current Month" : "Year to Date";

    data.forEach(item => {
      const pct = ((item.amt / total) * 100).toFixed(1);

      const row = document.createElement("div");
      row.className = "cat-row";

      row.innerHTML = `
        <div class="cat-left">
          <div class="cat-name">${item.cat}</div>
          <div class="cat-share">${pct}% of spend</div>
        </div>
        <div class="cat-amt">â‚¹${item.amt.toLocaleString("en-IN")}</div>
      `;

      list.appendChild(row);
    });
  }

  /* Initial load */
  loadCategories(dashboardMode);

  /* React to toggle */
  document.addEventListener("dashboardModeChanged", e => {
    loadCategories(e.detail.mode);
  });
</script>

  <!-- ===============================
     SAFETY & COMMITMENTS
=============================== -->
<section class="glass safety-card">

  <details open>
    <summary class="section-title">
      Account Balances
    </summary>

    <div id="accountBalances" class="account-list">
      <!-- injected -->
    </div>
  </details>

  <details>
    <summary class="section-title">
      EMI & Cash Runway
    </summary>

    <div class="emi-runway">

      <div class="emi-block">
        <span class="muted">Monthly EMI</span>
        <strong id="emiMonthly">â‚¹â€”</strong>
      </div>

      <div class="emi-block">
        <span class="muted">Remaining EMI</span>
        <strong id="emiRemaining">â‚¹â€”</strong>
      </div>

      <div class="emi-block">
        <span class="muted">Cash Runway</span>
        <strong id="cashRunway">â€” days</strong>
      </div>

    </div>

  </details>

</section>

<style>
  /* ===============================
     SAFETY CARD
  =============================== */
  .safety-card {
    padding: 18px;
    margin-bottom: 30px;
  }

  details {
    margin-bottom: 16px;
  }

  summary.section-title {
    font-size: 15px;
    font-weight: 600;
    cursor: pointer;
    list-style: none;
    outline: none;
  }

  summary.section-title::-webkit-details-marker {
    display: none;
  }

  summary.section-title::after {
    content: "â–¾";
    float: right;
    opacity: 0.6;
  }

  details[open] summary.section-title::after {
    content: "â–´";
  }

  /* ===============================
     ACCOUNT LIST
  =============================== */
  .account-list {
    margin-top: 12px;
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  .account-row {
    display: flex;
    justify-content: space-between;
    padding: 10px 12px;
    border-radius: var(--radius-md);
    background: rgba(255,255,255,0.05);
  }

  .account-name {
    font-weight: 500;
  }

  .account-balance {
    font-weight: 600;
  }

  .low {
    color: var(--warning);
  }

  .danger {
    color: var(--danger);
  }

  /* ===============================
     EMI & RUNWAY
  =============================== */
  .emi-runway {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 14px;
    margin-top: 14px;
  }

  .emi-block {
    background: rgba(255,255,255,0.05);
    padding: 12px;
    border-radius: var(--radius-md);
    font-size: 13px;
  }
</style>

<script>
  /* ===============================
     SAFETY DATA HANDLER
  =============================== */

  function loadSafety(mode) {
    /**
     * TEMP DATA (replace with real sheets later)
     */
    const accounts = [
      { name: "IDFC", bal: 28486 },
      { name: "SBI", bal: -1750 },
      { name: "Jupiter", bal: -990 },
      { name: "Cash", bal: 0 }
    ];

    const monthlyEMI = 14496;
    const remainingEMI = 166102;
    const dailyBurn = 450;
    const runwayDays = Math.floor(
      (accounts.find(a => a.name === "Cash")?.bal || 0) / dailyBurn
    );

    // Accounts
    const accBox = document.getElementById("accountBalances");
    accBox.innerHTML = "";

    accounts.forEach(acc => {
      const row = document.createElement("div");
      row.className = "account-row";

      let balClass = "account-balance";
      if (acc.bal < 0) balClass += " danger";
      else if (acc.bal < 1500) balClass += " low";

      row.innerHTML = `
        <div class="account-name">${acc.name}</div>
        <div class="${balClass}">
          â‚¹${acc.bal.toLocaleString("en-IN")}
        </div>
      `;

      accBox.appendChild(row);
    });

    // EMI + Runway
    document.getElementById("emiMonthly").innerText =
      "â‚¹" + monthlyEMI.toLocaleString("en-IN");

    document.getElementById("emiRemaining").innerText =
      "â‚¹" + remainingEMI.toLocaleString("en-IN");

    document.getElementById("cashRunway").innerText =
      runwayDays > 0 ? runwayDays + " days" : "Critical";
  }

  /* Initial load */
  loadSafety(dashboardMode);

  /* React to toggle */
  document.addEventListener("dashboardModeChanged", e => {
    loadSafety(e.detail.mode);
  });
</script>

  <!-- ===============================
     AI INSIGHTS
=============================== -->
<section class="glass ai-card">

  <div class="ai-header">
    <div class="ai-title">AI Insights</div>
    <div class="ai-sub">What needs attention right now</div>
  </div>

  <div id="aiInsights" class="ai-list">
    <!-- insights injected -->
  </div>

</section>

<style>
  /* ===============================
     AI CARD
  =============================== */
  .ai-card {
    padding: 18px;
    margin-bottom: 36px;
  }

  .ai-header {
    margin-bottom: 12px;
  }

  .ai-title {
    font-size: 15px;
    font-weight: 600;
  }

  .ai-sub {
    font-size: 12px;
    color: var(--text-muted);
    margin-top: 2px;
  }

  /* ===============================
     INSIGHT LIST
  =============================== */
  .ai-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .ai-item {
    padding: 12px;
    border-radius: var(--radius-md);
    background: rgba(255,255,255,0.06);
    border-left: 4px solid transparent;
  }

  .ai-item.info {
    border-color: var(--info);
  }

  .ai-item.warning {
    border-color: var(--warning);
  }

  .ai-item.critical {
    border-color: var(--danger);
  }

  .ai-head {
    font-size: 13px;
    font-weight: 600;
    margin-bottom: 4px;
  }

  .ai-text {
    font-size: 13px;
    color: var(--text-muted);
    line-height: 1.4;
  }

  .ai-action {
    font-size: 12px;
    margin-top: 6px;
    color: var(--accent);
    font-weight: 500;
  }
</style>

<script>
  /* ===============================
     AI LOGIC ENGINE (RULE-BASED)
  =============================== */

  function loadAIInsights(mode) {
    /**
     * TEMP DATA â€” replace with real computed metrics later
     */
    const balanceRisk = {
      account: "Jupiter",
      balance: -990,
      safe: 1500,
      source: "Cash",
      transfer: 2490
    };

    const budgetBurn = 48.3;
    const runwayDays = 0;
    const insights = [];

    // Insight 1: Balance Risk
    if (balanceRisk.balance < balanceRisk.safe) {
      insights.push({
        level: "critical",
        title: "Low Balance Alert â€“ " + balanceRisk.account,
        text:
          `Balance â‚¹${balanceRisk.balance.toLocaleString("en-IN")} ` +
          `is below safe limit â‚¹${balanceRisk.safe.toLocaleString("en-IN")}.`,
        action:
          `Transfer â‚¹${balanceRisk.transfer.toLocaleString("en-IN")} from ${balanceRisk.source}`
      });
    }

    // Insight 2: Budget Burn / Runway
    if (runwayDays <= 0) {
      insights.push({
        level: "warning",
        title: "Cash Runway Exhausted",
        text:
          "At current spending rate, available cash is insufficient.",
        action:
          "Reduce discretionary spends or move funds to Cash"
      });
    } else if (budgetBurn > 70) {
      insights.push({
        level: "warning",
        title: "High Budget Burn",
        text:
          `You have already used ${budgetBurn.toFixed(1)}% of your budget.`,
        action:
          "Slow down non-essential expenses"
      });
    } else {
      insights.push({
        level: "info",
        title: "Spending Under Control",
        text:
          "Your spending is within planned limits.",
        action:
          "Continue tracking expenses regularly"
      });
    }

    // Render (MAX 2 insights)
    const box = document.getElementById("aiInsights");
    box.innerHTML = "";

    insights.slice(0, 2).forEach(i => {
      const div = document.createElement("div");
      div.className = `ai-item ${i.level}`;

      div.innerHTML = `
        <div class="ai-head">${i.title}</div>
        <div class="ai-text">${i.text}</div>
        <div class="ai-action">â†’ ${i.action}</div>
      `;

      box.appendChild(div);
    });
  }

  /* Initial load */
  loadAIInsights(dashboardMode);

  /* React to toggle */
  document.addEventListener("dashboardModeChanged", e => {
    loadAIInsights(e.detail.mode);
  });
</script>
<!-- ===============================
     FOOTER & SYSTEM
=============================== -->
<footer class="app-footer">

  <div class="footer-left">
    <div class="footer-title">Kaiwalyaâ€™s Finance Dashboard</div>
    <div class="footer-sub">
      Tracking money with clarity, not stress
    </div>
  </div>

  <div class="footer-right">
    <span id="selectedPeriod">Period: â€”</span>
  </div>

</footer>

<!-- PWA INSTALL PROMPT -->
<div id="pwaPrompt" class="pwa-prompt hidden">
  <div>
    <strong>Install Dashboard</strong>
    <div class="muted">Access like an app on your phone</div>
  </div>
  <button id="pwaInstallBtn">Install</button>
</div>

<style>
  /* ===============================
     FOOTER
  =============================== */
  .app-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 14px 6px 24px;
    font-size: 12px;
    color: var(--text-muted);
  }

  .footer-title {
    font-weight: 600;
    color: var(--text);
  }

  .footer-sub {
    font-size: 11px;
    margin-top: 2px;
  }

  /* ===============================
     PWA PROMPT
  =============================== */
  .pwa-prompt {
    position: fixed;
    bottom: 14px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(30, 30, 40, 0.95);
    border-radius: var(--radius-lg);
    padding: 12px 16px;
    display: flex;
    gap: 14px;
    align-items: center;
    z-index: 999;
    box-shadow: 0 12px 30px rgba(0,0,0,0.4);
  }

  .pwa-prompt.hidden {
    display: none;
  }

  .pwa-prompt button {
    background: var(--accent);
    color: #fff;
    border: none;
    border-radius: 999px;
    padding: 6px 14px;
    font-size: 12px;
    cursor: pointer;
  }
</style>

<script>
  /* ===============================
     PERIOD DISPLAY
  =============================== */

  function updatePeriodLabel(mode) {
    const now = new Date();
    const month = now.toLocaleDateString("en-US", {
      month: "long",
      year: "numeric"
    });

    document.getElementById("selectedPeriod").innerText =
      mode === "MONTH"
        ? `Period: ${month}`
        : `Period: Year to Date (${now.getFullYear()})`;
  }

  updatePeriodLabel(dashboardMode);

  document.addEventListener("dashboardModeChanged", e => {
    updatePeriodLabel(e.detail.mode);
  });

  /* ===============================
     PWA INSTALL LOGIC
  =============================== */

  let deferredPrompt;

  window.addEventListener("beforeinstallprompt", e => {
    e.preventDefault();
    deferredPrompt = e;
    document.getElementById("pwaPrompt").classList.remove("hidden");
  });

  document.getElementById("pwaInstallBtn").addEventListener("click", () => {
    if (!deferredPrompt) return;
    deferredPrompt.prompt();
    deferredPrompt.userChoice.finally(() => {
      deferredPrompt = null;
      document.getElementById("pwaPrompt").classList.add("hidden");
    });
  });
</script>

</main>
  
  
</body>
</html>
