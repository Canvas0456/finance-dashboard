<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Kaiwalya â€¢ Financial Intelligence</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://www.gstatic.com/charts/loader.js"></script>

<style>
:root{
  --bg:#020617;
  --card:#020617;
  --border:#1e293b;
  --text:#e5e7eb;
  --muted:#94a3b8;

  --safe:#064e3b;
  --warn:#78350f;
  --risk:#7f1d1d;
  --neutral:#020617;
}

*{box-sizing:border-box}

body{
  margin:0;
  background:radial-gradient(circle at top,#0f172a,#020617);
  font-family:system-ui,-apple-system;
  color:var(--text);
}

h1{text-align:center;margin:16px 0 4px;font-size:22px}
.sub{text-align:center;color:var(--muted);font-size:12px}

.section{padding:14px}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:12px}

.card{
  background:var(--card);
  border-radius:16px;
  padding:14px;
  box-shadow:inset 0 0 0 1px var(--border);
}

.card h3{font-size:11px;margin:0 0 6px;color:var(--muted)}
.card p{font-size:22px;margin:0;font-weight:600}

.badge{
  font-size:11px;
  padding:4px 10px;
  border-radius:999px;
}

.safe{background:var(--safe)}
.warn{background:var(--warn)}
.risk{background:var(--risk)}

.alert{
  margin-top:10px;
  padding:12px;
  border-radius:14px;
  font-size:13px;
}

.alert.red{background:var(--risk)}
.alert.yellow{background:var(--warn)}
.alert.green{background:var(--safe)}

.chart{
  margin-top:10px;
  padding:10px;
  background:var(--card);
  border-radius:16px;
}
</style>
</head>
<body>
<h1>ğŸ’¸ Financial Intelligence</h1>
<div class="sub">Runway-aware â€¢ Action-first â€¢ Calm</div>

<div class="section">
  <div class="grid" style="grid-template-columns:repeat(2,1fr)">
    <div class="card"><h3>Total Balance</h3><p id="kTotal">â€“</p></div>
    <div class="card"><h3>Net Cashflow</h3><p id="kNet">â€“</p></div>
    <div class="card"><h3>Cash Runway</h3><p id="kRunway">â€“</p></div>
    <div class="card"><h3>MoM Change</h3><p id="kMoM">â€“</p></div>
  </div>
</div>
<div class="section">
  <h3>ğŸ¦ Account Safety (Runway-based)</h3>
  <div id="accounts" class="grid"></div>
</div>
<div class="section">
  <h3>ğŸ”¥ Cash Survival Gauge</h3>
  <div id="runwayGauge" class="chart" style="height:200px"></div>
</div>

<div class="section">
  <h3>ğŸ“Š Where money went</h3>
  <div id="donut" class="chart" style="height:240px"></div>
</div>
<div class="section">
  <h3>ğŸ§  What needs attention</h3>
  <div id="insights"></div>
</div>
<script>
google.charts.load("current",{packages:["corechart","gauge"]});
google.charts.setOnLoadCallback(init);

const SHEET_ID="1ApiV5dmKYycVw2IEnVKkNHY2ssLcOZZ1v1slU57UqM0";

function gviz(sheet){
  return fetch(`https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?sheet=${sheet}`)
    .then(r=>r.text())
    .then(t=>JSON.parse(t.substr(47).slice(0,-2)));
}
async function init(){
  loadKPIs();
  loadAccounts();
  loadRunwayGauge();
  loadDonut();
  loadAI();
}

async function loadKPIs(){
  const d=await gviz("Dashboard_KPIs");
  const m={};
  d.table.rows.forEach(r=>m[r.c[0].v]=r.c[1]?.v||0);
  kTotal.innerText="â‚¹"+m["Total Balance (All Accounts)"];
  kNet.innerText="â‚¹"+m["Current Month Net Savings"];
  kMoM.innerText=(m["MoM %"]||0)+"%";
  kRunway.innerText=(m["Cash Runway (Days)"]||"â€“")+" days";
}

async function loadAccounts(){
  const bal=await gviz("Account_Balances_Live");
  const run=await gviz("Account_Runway");
  accounts.innerHTML="";
  bal.table.rows.forEach((r,i)=>{
    const days=Number(run.table.rows[i]?.c[1]?.v||0);
    let cls="safe",label="Safe";
    if(days<5){cls="risk";label="Critical";}
    else if(days<10){cls="warn";label="Low";}
    accounts.innerHTML+=`
      <div class="card">
        <h3>${r.c[0].v}</h3>
        <p>${label} â€¢ ${days} days</p>
      </div>`;
  });
}

async function loadRunwayGauge(){
  const d=await gviz("Dashboard_KPIs");
  let val=0;
  d.table.rows.forEach(r=>{
    if(r.c[0].v==="Cash Runway (Days)") val=Number(r.c[1].v);
  });
  const data=google.visualization.arrayToDataTable([
    ["Label","Value"],
    ["Days",val]
  ]);
  new google.visualization.Gauge(runwayGauge)
    .draw(data,{
      min:0,max:30,
      redFrom:0,redTo:5,
      yellowFrom:5,yellowTo:10,
      greenFrom:10,greenTo:30
    });
}

async function loadDonut(){
  const d=await gviz("Category_Monthly_Actuals");
  const data=new google.visualization.DataTable();
  data.addColumn("string","Category");
  data.addColumn("number","Amount");
  d.table.rows.forEach(r=>{
    if(Number(r.c[2].v)>0) data.addRow([r.c[1].v,Number(r.c[2].v)]);
  });
  if(data.getNumberOfRows())
    new google.visualization.PieChart(donut)
      .draw(data,{pieHole:0.65,legend:"none",backgroundColor:"transparent"});
}

async function loadAI(){
  const d=await gviz("AI_Insights");
  insights.innerHTML="";
  d.table.rows.forEach(r=>{
    if(!r.c[0].v) return;
    let cls=r.c[1].v==="HIGH"?"red":r.c[1].v==="MEDIUM"?"yellow":"green";
    insights.innerHTML+=`
      <div class="alert ${cls}">
        <strong>${r.c[2].v}</strong><br>
        ${r.c[3].v}<br>
        <em>${r.c[4].v}</em>
      </div>`;
  });
}
</script>
</body>
</html>
  
  
  
  
  
