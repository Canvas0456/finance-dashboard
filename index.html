<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Personal Dashboard</title>

<style>
:root {
  --bg: #f7f8fa;
  --card: #ffffff;
  --text: #1c1c1e;
  --muted: #6e6e73;

  --good: #34c759;
  --warn: #ff9f0a;
  --alert: #ff453a;

  --radius: 14px;
  --shadow: 0 6px 20px rgba(0,0,0,0.06);
}

* {
  box-sizing: border-box;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
}

body {
  margin: 0;
  background: var(--bg);
  color: var(--text);
}

.app {
  max-width: 1100px;
  margin: auto;
  padding: 20px;
}

/* HEADER */
.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}

.date {
  font-size: 14px;
  color: var(--muted);
}

.streak {
  font-size: 14px;
  background: var(--card);
  padding: 8px 14px;
  border-radius: 999px;
  box-shadow: var(--shadow);
}

/* THOUGHT */
.thought {
  background: var(--card);
  padding: 16px;
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  margin-bottom: 24px;
  font-style: italic;
  color: var(--muted);
}

/* KPI GRID */
.kpi-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
  gap: 16px;
}

.kpi {
  background: var(--card);
  border-radius: var(--radius);
  padding: 16px;
  box-shadow: var(--shadow);
}

.kpi-title {
  font-size: 13px;
  color: var(--muted);
}

.kpi-value {
  font-size: 26px;
  font-weight: 600;
}

.kpi-status {
  font-size: 12px;
  margin-top: 4px;
}

.good { color: var(--good); }
.warn { color: var(--warn); }
.alert { color: var(--alert); }

/* FORMS */
.form-card {
  background: var(--card);
  padding: 16px;
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  margin-top: 24px;
}

.form-card h3 {
  margin-top: 0;
}

input, select, button {
  width: 100%;
  padding: 10px;
  margin-top: 10px;
  border-radius: 10px;
  border: 1px solid #ddd;
  font-size: 14px;
}

button {
  background: #000;
  color: #fff;
  border: none;
  cursor: pointer;
}

button:hover {
  opacity: 0.9;
}
</style>
</head>

  <body>
<div class="app">

  <!-- HEADER -->
  <div class="header">
    <div class="date" id="todayDate">â€”</div>
    <div class="streak">ðŸ”¥ <span id="streakCount">1</span>-day streak</div>
  </div>

  <!-- THOUGHT -->
  <div class="thought" id="thought">
    Loading thought of the dayâ€¦
  </div>

  <!-- KPI GRID -->
  <div class="kpi-grid" id="kpiGrid"></div>

  <!-- TRANSACTION FORM -->
  <div class="form-card">
    <h3>Add Transaction</h3>
    <input type="date" id="txnDate">
    <input type="text" id="txnAccount" placeholder="Account">
    <select id="txnType">
      <option>Income</option>
      <option>Expense</option>
      <option>Investment</option>
      <option>EMI</option>
    </select>
    <input type="text" id="txnCategory" placeholder="Category">
    <input type="number" id="txnAmount" placeholder="Amount">
    <button onclick="submitTransaction()">Save Transaction</button>
  </div>

  <!-- HEALTH FORM -->
  <div class="form-card">
    <h3>Daily Health Entry</h3>
    <input type="date" id="healthDate">
    <input type="number" id="healthSteps" placeholder="Steps">
    <input type="number" id="healthSleep" placeholder="Sleep Hours">
    <input type="text" id="healthWorkout" placeholder="Workout Type">
    <input type="number" min="1" max="10" id="healthStress" placeholder="Stress (1-10)">
    <button onclick="submitHealth()">Save Health Entry</button>
  </div>

  <script>
/* ================= CONFIG ================= */

const API_BASE = "https://script.google.com/macros/s/AKfycbw8xsP1TRYdTP7FkASoX_O4n25rt8vhaO-DhU-6GgiktTCSVzZWtkEFjrVWIjpPVuoh/exec";

/* ================= DATE ================= */

document.getElementById("todayDate").innerText =
  new Date().toLocaleDateString("en-IN", {
    day: "numeric",
    month: "short",
    year: "numeric"
  });

/* ================= THOUGHT ================= */

const thoughts = [
  "Consistency beats intensity.",
  "Small steps every day create big change.",
  "What you repeat daily defines you.",
  "Progress over perfection."
];

document.getElementById("thought").innerText =
  thoughts[Math.floor(Math.random() * thoughts.length)];

/* ================= KPI FETCH ================= */

fetch(API_BASE + "?sheet=KPI_Cards")
  .then(res => res.json())
  .then(data => renderKPIs(data.rows));

function renderKPIs(rows) {
  const grid = document.getElementById("kpiGrid");
  grid.innerHTML = "";

  rows.forEach(r => {
    let value = r.Value;
    if (r.Unit === "INR") value = "â‚¹" + Math.round(value);
    if (r.Unit === "%") value = Math.round(value * 100) + "%";

    const card = document.createElement("div");
    card.className = "kpi";
    card.innerHTML = `
      <div class="kpi-title">${r.Metric.replaceAll("_"," ")}</div>
      <div class="kpi-value">${value}</div>
      <div class="kpi-status ${r.Status.toLowerCase()}">${r.Status}</div>
    `;
    grid.appendChild(card);
  });
}

/* ================= TRANSACTION ================= */

function submitTransaction() {
  const payload = {
    sheet: "TXN_Raw",
    values: [
      txnDate.value,
      txnAccount.value,
      txnType.value,
      txnCategory.value,
      "",
      Number(txnAmount.value),
      ""
    ]
  };

  fetch(API_BASE, {
    method: "POST",
    body: JSON.stringify(payload)
  })
  .then(() => alert("Transaction Saved"));
}

/* ================= HEALTH ================= */

function submitHealth() {
  const payload = {
    sheet: "Health_Raw",
    values: [
      healthDate.value,
      Number(healthSteps.value),
      "",
      healthWorkout.value,
      "",
      Number(healthSleep.value),
      "",
      Number(healthStress.value)
    ]
  };

  fetch(API_BASE, {
    method: "POST",
    body: JSON.stringify(payload)
  })
  .then(() => alert("Health Entry Saved"));

  /* ================= STREAK ================= */

const STREAK_KEY = "dashboard_streak";
const LAST_KEY = "dashboard_last_visit";

function todayStr(d=new Date()) {
  return d.toISOString().split("T")[0];
}

function updateStreak() {
  const today = todayStr();
  const yesterday = todayStr(new Date(Date.now() - 86400000));

  let streak = Number(localStorage.getItem(STREAK_KEY)) || 0;
  const last = localStorage.getItem(LAST_KEY);

  if (last === yesterday) streak++;
  else if (last !== today) streak = 1;

  localStorage.setItem(STREAK_KEY, streak);
  localStorage.setItem(LAST_KEY, today);
  streakCount.innerText = streak;
}

updateStreak();
</script>

</div>
</body>
</html>
