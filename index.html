<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Kaiwalya ‚Äì Finance Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Google Charts -->
<script src="https://www.gstatic.com/charts/loader.js"></script>
<script>
google.charts.load("current", { packages:["corechart","table"] });
</script>

<style>
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto;
  background: #0f172a;
  color: #e5e7eb;
}
.container {
  padding: 16px;
  max-width: 1100px;
  margin: auto;
}
h1 {
  font-size: 22px;
  margin: 8px 0 16px;
}
.section-title {
  margin-top: 28px;
  font-size: 18px;
}
.grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
  gap: 12px;
}
.card {
  background: #020617;
  border-radius: 14px;
  padding: 14px;
  box-shadow: 0 0 0 1px #1e293b;
}
.card h3 {
  font-size: 12px;
  color: #94a3b8;
  margin: 0;
}
.card p {
  font-size: 20px;
  margin: 6px 0 0;
  font-weight: 600;
}
.bar {
  height: 10px;
  background: #1e293b;
  border-radius: 8px;
  overflow: hidden;
}
.bar span {
  display: block;
  height: 100%;
  background: linear-gradient(90deg,#22c55e,#4ade80);
}
.table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 12px;
}
.table th, .table td {
  text-align: left;
  padding: 8px;
  border-bottom: 1px solid #1e293b;
  font-size: 13px;
}
.alert {
  background:#7c2d12;
  color:#f97316;
  padding:10px;
  border-radius:10px;
  margin-bottom:10px;
  font-size:14px;
}
.badge {
  padding: 4px 8px;
  border-radius: 8px;
  font-size: 12px;
}
.ok { background:#14532d; color:#22c55e; }
.warn { background:#7c2d12; color:#f97316; }
</style>
</head>

<body>
<div class="container">

<h1>üìä Kaiwalya ‚Äì Finance Dashboard</h1>

<div id="alerts"></div>

<!-- KPI -->
<div class="grid" id="kpis"></div>

<!-- Budget -->
<h2 class="section-title">üí∞ Budget vs Actual</h2>
<div class="grid" id="budget"></div>

<!-- Charts -->
<h2 class="section-title">üìä Expense Breakdown</h2>
<div id="donut" style="height:300px"></div>

<h2 class="section-title">üìà Monthly Expense Trend</h2>
<div id="trend" style="height:300px"></div>

<!-- EMI -->
<h2 class="section-title">üìâ EMI Tracker</h2>
<table class="table" id="emi"></table>

</div>

<script>
const SHEET_ID =
"2PACX-1vRLH-y2NpSvaDb6aVZQweoO2Bymd-PIN6EiPblnuUmIFqBkoqIu2p8UXW6uMb_TCZbLKIIBXHpHP3La";

function fetchSheet(sheetName, callback) {
  const url = `https://docs.google.com/spreadsheets/d/e/${SHEET_ID}/gviz/tq?sheet=${sheetName}`;
  const query = new google.visualization.Query(url);
  query.setQuery("select *");
  query.send(res => {
    if (res.isError()) return;
    const dt = res.getDataTable();
    const rows = [];
    for (let i=0;i<dt.getNumberOfRows();i++){
      const r=[];
      for (let j=0;j<dt.getNumberOfColumns();j++){
        r.push(dt.getValue(i,j));
      }
      rows.push(r);
    }
    callback(rows);
  });
}

google.charts.setOnLoadCallback(() => {

  /* KPIs */
  fetchSheet("Dashboard_KPIs", rows => {
    const k = document.getElementById("kpis");
    rows.forEach(r=>{
      k.innerHTML+=`
        <div class="card">
          <h3>${r[0]}</h3>
          <p>${r[1]}</p>
        </div>`;
    });
  });

  /* Budgets + Alerts + Donut */
  fetchSheet("Budgets_vs_Actuals", rows => {
    const b = document.getElementById("budget");
    const a = document.getElementById("alerts");

    const pie = new google.visualization.DataTable();
    pie.addColumn("string","Category");
    pie.addColumn("number","Actual");

    rows.forEach(r=>{
      const cat=r[1], budget=Number(r[2]), actual=Number(r[3]);
      const pct=Math.min(100,Math.round(actual/budget*100||0));

      b.innerHTML+=`
        <div class="card">
          <h3>${cat}</h3>
          <p>‚Çπ${actual} / ‚Çπ${budget}</p>
          <div class="bar"><span style="width:${pct}%"></span></div>
        </div>`;

      if(actual>budget && budget>0){
        a.innerHTML+=`
          <div class="alert">
            ‚ö†Ô∏è ${cat} overspent by ‚Çπ${actual-budget}
          </div>`;
      }

      if(actual>0) pie.addRow([cat,actual]);
    });

    new google.visualization.PieChart(
      document.getElementById("donut")
    ).draw(pie,{
      pieHole:0.6,
      backgroundColor:"transparent",
      legend:{textStyle:{color:"#e5e7eb"}}
    });
  });

  /* Trend */
  fetchSheet("Finance_Monthly_Summary", rows => {
    const dt=new google.visualization.DataTable();
    dt.addColumn("string","Month");
    dt.addColumn("number","Expenses");

    rows.forEach(r=>{
      if(r[0]) dt.addRow([r[0],Number(r[2])]);
    });

    new google.visualization.LineChart(
      document.getElementById("trend")
    ).draw(dt,{
      backgroundColor:"transparent",
      legend:{textStyle:{color:"#e5e7eb"}},
      hAxis:{textStyle:{color:"#94a3b8"}},
      vAxis:{textStyle:{color:"#94a3b8"}}
    });
  });

  /* EMI */
  fetchSheet("Insight_EMI_Automated", rows => {
    const t=document.getElementById("emi");
    t.innerHTML=`
      <tr><th>EMI</th><th>Months Left</th><th>Remaining ‚Çπ</th><th>Status</th></tr>`;
    rows.forEach(r=>{
      const badge=r[6].includes("COMPLETED")?"ok":"warn";
      t.innerHTML+=`
        <tr>
          <td>${r[0]}</td>
          <td>${r[3]}</td>
          <td>‚Çπ${r[5]}</td>
          <td><span class="badge ${badge}">${r[6]}</span></td>
        </tr>`;
    });
  });

});
</script>

</body>
</html>
