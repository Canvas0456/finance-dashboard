<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Kaiwalya’s Finance Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --bg:#f8f5f0;          /* Ivory background */
  --card:#fffdf9;        /* Soft ivory card */
  --border:#e7e2d9;
  --text:#2f2f2f;
  --muted:#7a746b;
  --accent:#8b7d6b;      /* Finance neutral */
}

*{box-sizing:border-box}

body{
  margin:0;
  background:var(--bg);
  font-family:system-ui,-apple-system;
  color:var(--text);
}

/* Fixed top bar */
.top-bar{
  position:fixed;
  top:0;
  left:0;
  right:0;
  height:52px;
  background:var(--card);
  border-bottom:1px solid var(--border);
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:0 16px;
  z-index:1000;
}

.title{
  font-size:16px;
  font-weight:600;
}

.date{
  font-size:13px;
  color:var(--muted);
}

/* Page content */
.container{
  padding:76px 14px 28px;
}

/* KPI grid */
.kpi-grid{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:12px;
}

.kpi{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:14px;
  padding:14px;
}

.kpi h3{
  margin:0;
  font-size:12px;
  font-weight:500;
  color:var(--muted);
}

.kpi p{
  margin:6px 0 0;
  font-size:22px;
  font-weight:600;
  letter-spacing:0.2px;
}

.kpi.accent{
  border-color:var(--accent);
}

/* Budget bar */
.budget-wrap{
  margin-top:18px;
}

.budget-labels{
  display:flex;
  justify-content:space-between;
  font-size:12px;
  color:var(--muted);
  margin-bottom:6px;
}

.budget-bar-bg{
  height:10px;
  background:#e7e2d9;
  border-radius:999px;
  overflow:hidden;
}

.budget-bar-used{
  height:100%;
  width:0%;
  background:var(--accent);
  border-radius:999px;
}

/* Responsive */
@media(min-width:640px){
  .kpi-grid{
    grid-template-columns:repeat(3,1fr);
  }
}
</style>
</head>
<body>

<!-- Top fixed bar -->
<div class="top-bar">
  <div class="title">Kaiwalya’s Finance Dashboard</div>
  <div class="date" id="todayDate">–</div>
</div>

<!-- Main content -->
<div class="container">

  <!-- KPI Cards -->
  <div class="kpi-grid">
    <div class="kpi">
      <h3>Available Balance</h3>
      <p id="kBalance">₹–</p>
    </div>

    <div class="kpi">
      <h3>Total Expense</h3>
      <p id="kExpense">₹–</p>
    </div>

    <div class="kpi accent">
      <h3>Budget Burn %</h3>
      <p id="kBurn">–%</p>
    </div>
  </div>

  <!-- Budget Remaining Bar -->
  <div class="budget-wrap">
    <div class="budget-labels">
      <span id="budgetUsedLabel">Used: –%</span>
      <span id="budgetRemainLabel">Remaining: –%</span>
    </div>
    <div class="budget-bar-bg">
      <div class="budget-bar-used" id="budgetUsedBar"></div>
    </div>
  </div>

</div>

<script>
/* Today's Date */
const d = new Date();
todayDate.innerText = d.toLocaleDateString("en-IN", {
  day:"2-digit",
  month:"short",
  year:"numeric"
});

/* Google Sheet Config */
const SHEET_ID = "1ApiV5dmKYycVw2IEnVKkNHY2ssLcOZZ1v1slU57UqM0";
const KPI_SHEET = "Dashboard_KPIs";

function fetchSheet(sheet){
  const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=${sheet}`;
  return fetch(url)
    .then(res => res.text())
    .then(text => JSON.parse(text.substring(47).slice(0,-2)));
}

/* Load KPIs */
async function loadKPIs(){
  const data = await fetchSheet(KPI_SHEET);
  const rows = data.table.rows;

  let balance = 0;
  let expense = 0;
  let burnPct = 0;

  rows.forEach(r=>{
    const k = r.c[0]?.v;
    const v = r.c[1]?.v;

    if(k==="Total Balance (All Accounts)") balance = v;
    if(k==="Current Month Expenses") expense = v;
    if(k==="Budget Used %") burnPct = v;
  });

  const used = Math.round(burnPct * 100);
  const remaining = 100 - used;

  kBalance.innerText = "₹" + balance.toLocaleString("en-IN");
  kExpense.innerText = "₹" + expense.toLocaleString("en-IN");
  kBurn.innerText = used + "%";

  budgetUsedBar.style.width = used + "%";
  budgetUsedLabel.innerText = "Used: " + used + "%";
  budgetRemainLabel.innerText = "Remaining: " + remaining + "%";
}

loadKPIs();
</script>

</body>
</html>
