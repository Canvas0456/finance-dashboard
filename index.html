<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Financial Intelligence</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://www.gstatic.com/charts/loader.js"></script>

<style>
:root{
  --bg:#020617;
  --card:#020617;
  --border:#1e293b;
  --text:#e5e7eb;
  --muted:#94a3b8;

  --safe:#064e3b;
  --warn:#78350f;
  --risk:#7f1d1d;
}

*{box-sizing:border-box}

body{
  margin:0;
  background:radial-gradient(circle at top,#0f172a,#020617);
  font-family:system-ui,-apple-system;
  color:var(--text);
}

h1{
  text-align:center;
  margin:18px 0 6px;
  font-size:22px;
}

.sub{
  text-align:center;
  color:var(--muted);
  font-size:12px;
}

.section{padding:14px}

.card{
  background:var(--card);
  border-radius:16px;
  padding:16px;
  box-shadow:inset 0 0 0 1px var(--border);
}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(160px,1fr));
  gap:12px;
}

.alert{
  border-radius:14px;
  padding:14px;
  font-size:14px;
}

.alert.safe{background:var(--safe)}
.alert.warn{background:var(--warn)}
.alert.risk{background:var(--risk)}

.small{font-size:12px;color:var(--muted)}

details summary{
  cursor:pointer;
  color:#cbd5f5;
}
</style>
</head>
<body>
<h1>üí° Financial Status</h1>
<div class="sub">Calm ‚Ä¢ Today-focused ‚Ä¢ Action-first</div>

<div class="section">
  <div class="card" style="text-align:center">
    <div id="statusLine" style="font-size:26px;font-weight:700">‚Äì</div>
    <div id="statusSub" class="small">‚Äì</div>
  </div>
</div>

<div class="section">
  <h3>üëâ What to do now</h3>
  <div id="primaryAction"></div>
</div>

  <div class="section">
  <h3>‚ö†Ô∏è Accounts needing attention</h3>
  <div id="riskyAccounts" class="grid"></div>
</div>

  <div class="section">
  <h3>üì• Money to receive</h3>
  <div id="receivables"></div>
</div>

  <div class="section">
  <div class="grid">
    <div class="card">
      <h3>Total Balance</h3>
      <div id="kTotal">‚Äì</div>
    </div>
    <div class="card">
      <h3>Net Cashflow (Month)</h3>
      <div id="kNet">‚Äì</div>
    </div>
    <div class="card">
      <h3>Cash Runway</h3>
      <div id="kRunway">‚Äì</div>
    </div>
  </div>
</div>

  <div class="section">
  <details>
    <summary>üìä Where money went</summary>
    <div id="donut" style="height:220px"></div>
  </details>
</div>

  <script>
google.charts.load("current",{packages:["corechart"]});
google.charts.setOnLoadCallback(init);

const SHEET_ID="1ApiV5dmKYycVw2IEnVKkNHY2ssLcOZZ1v1slU57UqM0";

function gviz(sheet){
  return fetch(`https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?sheet=${sheet}`)
    .then(r=>r.text())
    .then(t=>JSON.parse(t.substr(47).slice(0,-2)));
}

  async function init(){
  await loadStatus();
  await loadPrimaryAction();
  await loadRiskyAccounts();
  await loadReceivables();
  await loadContext();
  await loadDonut();
}

async function loadStatus(){
  const d=await gviz("Dashboard_KPIs");
  let runway=0;
  d.table.rows.forEach(r=>{
    if(r.c[0].v==="Cash Runway (Days)") runway=Number(r.c[1].v);
  });

  if(runway>=10){
    statusLine.innerText="You are financially stable today.";
    statusSub.innerText="No immediate action required.";
  }else if(runway>=5){
    statusLine.innerText="Cash is tight.";
    statusSub.innerText="Avoid unnecessary spending this week.";
  }else{
    statusLine.innerText="Immediate action needed.";
    statusSub.innerText="You may run out of cash very soon.";
  }
}

async function loadPrimaryAction(){
  const d=await gviz("AI_Insights");
  primaryAction.innerHTML="";
  d.table.rows.forEach(r=>{
    if(r.c[1].v==="HIGH"){
      primaryAction.innerHTML=`
        <div class="alert risk">
          <strong>${r.c[2].v}</strong><br>
          ${r.c[3].v}<br>
          <em>${r.c[4].v}</em>
        </div>`;
    }
  });
}

async function loadRiskyAccounts(){
  const bal=await gviz("Account_Balances_Live");
  const run=await gviz("Account_Runway");
  riskyAccounts.innerHTML="";

  bal.table.rows.forEach((r,i)=>{
    const days=Number(run.table.rows[i]?.c[1]?.v||0);
    if(days>=10) return;

    riskyAccounts.innerHTML+=`
      <div class="card">
        <strong>${r.c[0].v}</strong><br>
        ${days} days runway
      </div>`;
  });
}

async function loadReceivables(){
  const d=await gviz("Receivables_Payables");
  let html="";
  d.table.rows.forEach(r=>{
    if(r.c[2].v>0){
      html+=`
        <div class="card" style="margin-bottom:8px">
          <strong>${r.c[0].v}</strong><br>
          ‚Çπ${r.c[2].v}
        </div>`;
    }
  });
  receivables.innerHTML=html||"<div class='small'>No receivables</div>";
}

async function loadContext(){
  const d=await gviz("Dashboard_KPIs");
  const m={};
  d.table.rows.forEach(r=>m[r.c[0].v]=r.c[1]?.v||0);
  kTotal.innerText="‚Çπ"+m["Total Balance (All Accounts)"];
  kNet.innerText="‚Çπ"+m["Current Month Net Savings"];
  kRunway.innerText=(m["Cash Runway (Days)"]||"‚Äì")+" days";
}

async function loadDonut(){
  const d=await gviz("Category_Monthly_Actuals");
  const data=new google.visualization.DataTable();
  data.addColumn("string","Category");
  data.addColumn("number","Amount");
  d.table.rows.forEach(r=>{
    if(Number(r.c[2].v)>0) data.addRow([r.c[1].v,Number(r.c[2].v)]);
  });
  if(data.getNumberOfRows())
    new google.visualization.PieChart(donut)
      .draw(data,{pieHole:0.65,legend:"none",backgroundColor:"transparent"});
}
</script>
</body>
</html>

  
  
