<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Kaiwalya’s Finance Dashboard</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
  --bg:#faf7f2;
  --card:#ffffff;
  --text:#2b2b2b;
  --muted:#7a7a7a;
  --accent:#4a6cf7;
  --danger:#e5533d;
  --warn:#f0a500;
  --success:#2e9e6f;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
  background:var(--bg);
  color:var(--text);
}

/* HEADER */
header{
  position:fixed;
  top:0;left:0;right:0;
  background:var(--bg);
  padding:16px 24px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  border-bottom:1px solid #e6e1d8;
  z-index:100;
}

header h1{
  margin:0;
  font-size:22px;
  font-weight:600;
}

.subtitle{
  font-size:13px;
  color:var(--muted);
}

.date{
  font-size:14px;
  color:var(--muted);
}

/* MAIN */
main{
  padding:120px 20px 40px;
  max-width:1200px;
  margin:auto;
}

/* TOGGLE */
.toggle{
  display:flex;
  gap:8px;
  margin-bottom:20px;
}

.toggle button{
  padding:6px 16px;
  border-radius:20px;
  border:1px solid #ddd;
  background:#fff;
  cursor:pointer;
}

.toggle button.active{
  background:var(--accent);
  color:#fff;
  border-color:var(--accent);
}

/* CARDS */
.kpis{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:16px;
}

.card{
  background:var(--card);
  border-radius:14px;
  padding:18px;
  box-shadow:0 6px 18px rgba(0,0,0,0.04);
}

.card h3{
  margin:0;
  font-size:13px;
  color:var(--muted);
}

.card p{
  margin:8px 0 0;
  font-size:22px;
  font-weight:600;
}

/* BUDGET BAR */
.budget{
  margin-top:24px;
}

.bar{
  height:14px;
  background:#e6e1d8;
  border-radius:10px;
  overflow:hidden;
}

.bar-fill{
  height:100%;
  width:0%;
  background:linear-gradient(90deg,var(--accent),#7aa2ff);
  transition:width 1s ease;
}

.bar-label{
  display:flex;
  justify-content:space-between;
  font-size:12px;
  margin-top:6px;
  color:var(--muted);
}

/* THOUGHT */
.thought{
  margin-top:24px;
  font-style:italic;
  font-size:14px;
  color:#555;
}

/* CHARTS */
.section{
  margin-top:40px;
}

canvas{
  background:var(--card);
  border-radius:14px;
  padding:16px;
}
</style>
</head>

<body>

<header>
  <div>
    <h1>Kaiwalya’s Finance Dashboard</h1>
    <div class="subtitle">Clarity over cash. Control over chaos.</div>
  </div>
  <div class="date" id="today"></div>
</header>

<main>

<div class="toggle">
  <button id="btnMonth" class="active">Month</button>
  <button id="btnYTD">YTD</button>
</div>

<!-- KPI CARDS -->
<div class="kpis">
  <div class="card"><h3>Total Balance</h3><p id="bal">—</p></div>
  <div class="card"><h3>Total Expenses</h3><p id="exp">—</p></div>
  <div class="card"><h3>Budget Burn %</h3><p id="burn">—</p></div>
  <div class="card"><h3>Budget Remaining</h3><p id="rem">—</p></div>
</div>

<!-- BUDGET BAR -->
<div class="budget card">
  <div class="bar">
    <div class="bar-fill" id="budgetBar"></div>
  </div>
  <div class="bar-label">
    <span id="usedLabel">Used —%</span>
    <span id="remLabel">Remaining ₹—</span>
  </div>
</div>

<!-- THOUGHT -->
<div class="thought" id="thought">Loading thought of the day…</div>

<!-- EXPENSE TREND -->
<div class="section">
  <canvas id="trendChart" height="130"></canvas>
</div>

<!-- CATEGORY -->
<div class="section">
  <canvas id="categoryChart" height="130"></canvas>
</div>

</main>

<script>
const SHEET_ID = "1ApiV5dmKYycVw2IEnVKkNHY2ssLcOZZ1v1slU57UqM0";
let mode = "Month";

document.getElementById("today").innerText =
  new Date().toLocaleDateString("en-IN",{day:"numeric",month:"short",year:"numeric"});

function fetchSheet(sheet){
  return fetch(`https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?sheet=${sheet}`)
    .then(r=>r.text())
    .then(t=>JSON.parse(t.substring(47).slice(0,-2)).table.rows);
}

/* Thought of the Day */
fetch("https://api.quotable.io/random?tags=wisdom|inspirational")
  .then(r=>r.json())
  .then(d=>document.getElementById("thought").innerText="“"+d.content+"”");

/* Toggle */
btnMonth.onclick=()=>{mode="Month";btnMonth.classList.add("active");btnYTD.classList.remove("active");load()};
btnYTD.onclick=()=>{mode="YTD";btnYTD.classList.add("active");btnMonth.classList.remove("active");load()};

let trendChart, categoryChart;

function load(){
  const sheet = mode==="Month" ? "Dashboard_KPIs_Month" : "Dashboard_KPIs_YTD";

  fetchSheet(sheet).then(rows=>{
    const d={};
    rows.forEach(r=>{if(r.c[0]&&r.c[1]) d[r.c[0].v]=r.c[1].v});

    document.getElementById("bal").innerText="₹"+d["Total Balance (All Accounts)"];
    document.getElementById("exp").innerText="₹"+(mode==="Month"?d["Current Month Expenses"]:d["YTD Expenses"]);

    const burn = (mode==="Month"?d["Budget Used %"]:d["YTD Budget Used %"])*100;
    document.getElementById("burn").innerText=burn.toFixed(1)+"%";
    document.getElementById("rem").innerText="₹"+(mode==="Month"?d["Budget Remaining"]:d["YTD Budget Remaining"]);

    document.getElementById("budgetBar").style.width=Math.min(burn,100)+"%";
    document.getElementById("usedLabel").innerText="Used "+burn.toFixed(1)+"%";
    document.getElementById("remLabel").innerText="Remaining ₹"+(mode==="Month"?d["Budget Remaining"]:d["YTD Budget Remaining"]);
  });

  /* Category Chart */
  fetchSheet("Budget_vs_Actual").then(rows=>{
    const labels=[], values=[];
    rows.forEach(r=>{
      if(r.c[6].v === (mode==="Month" ? document.getElementById("bal").innerText : r.c[6].v)){
        labels.push(r.c[1].v);
        values.push(r.c[3].v);
      }
    });

    if(categoryChart) categoryChart.destroy();
    categoryChart=new Chart(document.getElementById("categoryChart"),{
      type:"doughnut",
      data:{labels,datasets:[{data:values,backgroundColor:["#4a6cf7","#f0a500","#2e9e6f","#e5533d"]}]},
      options:{plugins:{legend:{position:"bottom"}}}
    });
  });
}

load();
</script>

</body>
</html>
