<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Kaiwalya‚Äôs Finance Dashboard</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
  --bg:#faf7f2;
  --card:#ffffff;
  --text:#2b2b2b;
  --muted:#7a7a7a;
  --accent:#4a6cf7;
  --danger:#e5533d;
  --warn:#f0a500;
  --success:#2e9e6f;
}

body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
  background:var(--bg);
  color:var(--text);
}

header{
  position:fixed;
  inset:0 0 auto 0;
  background:var(--bg);
  padding:16px 24px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  border-bottom:1px solid #e6e1d8;
  z-index:10;
}

h1{margin:0;font-size:20px;font-weight:600}
.date{font-size:14px;color:var(--muted)}

main{
  padding:96px 20px 40px;
  max-width:1200px;
  margin:auto;
}

.toggle{
  display:flex;
  gap:8px;
}

.toggle button{
  padding:6px 14px;
  border-radius:20px;
  border:1px solid #ddd;
  background:#fff;
  cursor:pointer;
}

.toggle button.active{
  background:var(--accent);
  color:#fff;
  border-color:var(--accent);
}

.kpis{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
  gap:16px;
  margin-top:20px;
}

.card{
  background:var(--card);
  border-radius:14px;
  padding:18px;
  box-shadow:0 6px 18px rgba(0,0,0,0.04);
}

.card h3{
  margin:0;
  font-size:13px;
  color:var(--muted);
}

.card p{
  margin:8px 0 0;
  font-size:22px;
  font-weight:600;
}

.meter{
  height:12px;
  border-radius:8px;
  background:#e6e1d8;
  overflow:hidden;
}

.meter-fill{
  height:100%;
  width:0%;
}

.insights{
  margin-top:30px;
}

.insight{
  background:#fff;
  border-left:4px solid var(--accent);
  padding:12px 14px;
  border-radius:10px;
  margin-bottom:10px;
  font-size:14px;
}
</style>
</head>

<body>

<header>
  <div>
    <h1>Kaiwalya‚Äôs Finance Dashboard</h1>
    <div class="date" id="today"></div>
  </div>
  <div class="toggle">
    <button id="btn-month" class="active">Month</button>
    <button id="btn-ytd">YTD</button>
  </div>
</header>

<main>

<!-- KPI CARDS -->
<div class="kpis">
  <div class="card"><h3>Total Balance</h3><p id="bal">‚Äî</p></div>
  <div class="card"><h3>Expenses</h3><p id="exp">‚Äî</p></div>
  <div class="card"><h3>Net Savings</h3><p id="save">‚Äî</p></div>
  <div class="card"><h3>Budget Used</h3><p id="bud">‚Äî</p></div>
</div>

<!-- EMI STRESS -->
<div class="card" style="margin-top:24px">
  <h3>EMI Stress (EMI √∑ Income)</h3>
  <div class="meter">
    <div class="meter-fill" id="emiMeter"></div>
  </div>
  <p id="emiText" style="margin-top:8px;font-size:14px;color:var(--muted)">‚Äî</p>
</div>

<!-- AI INSIGHTS -->
<div class="insights" id="insights"></div>

</main>

<script>
const SHEET_ID = "1ApiV5dmKYycVw2IEnVKkNHY2ssLcOZZ1v1slU57UqM0";
let mode = "Month";

document.getElementById("today").innerText =
  new Date().toLocaleDateString("en-IN",{day:"numeric",month:"short",year:"numeric"});

const btnMonth=document.getElementById("btn-month");
const btnYTD=document.getElementById("btn-ytd");

btnMonth.onclick=()=>{mode="Month";btnMonth.classList.add("active");btnYTD.classList.remove("active");load()};
btnYTD.onclick=()=>{mode="YTD";btnYTD.classList.add("active");btnMonth.classList.remove("active");load()};

function fetchSheet(sheet){
  const url=`https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?sheet=${sheet}`;
  return fetch(url)
    .then(r=>r.text())
    .then(t=>JSON.parse(t.substring(47).slice(0,-2)).table.rows);
}

function load(){
  const sheet = mode==="Month" ? "Dashboard_KPIs_Month" : "Dashboard_KPIs_YTD";

  fetchSheet(sheet).then(rows=>{
    const d={};
    rows.forEach(r=>{ if(r.c[0]&&r.c[1]) d[r.c[0].v]=r.c[1].v });

    const income = d[mode==="Month"?"Current Month Income":"YTD Income"];
    const emi = d[mode==="Month"?"EMI Paid (Current Month)":"EMI Paid (YTD)"];

    document.getElementById("bal").innerText="‚Çπ"+d["Total Balance (All Accounts)"];
    document.getElementById("exp").innerText="‚Çπ"+d[mode==="Month"?"Current Month Expenses":"YTD Expenses"];
    document.getElementById("save").innerText="‚Çπ"+d[mode==="Month"?"Current Month Net Savings":"YTD Net Savings"];
    document.getElementById("bud").innerText=(d[mode==="Month"?"Budget Used %":"YTD Budget Used %"]*100).toFixed(1)+"%";

    // EMI stress
    const stress = income>0 ? (emi/income)*100 : 0;
    const bar=document.getElementById("emiMeter");
    bar.style.width=Math.min(stress,100)+"%";
    bar.style.background= stress>35?"var(--danger)":stress>20?"var(--warn)":"var(--success)";
    document.getElementById("emiText").innerText = stress.toFixed(1)+"% of income";

    // AI insights
    const box=document.getElementById("insights");
    box.innerHTML="";
    if(stress>35) box.innerHTML+=`<div class="insight">üö® EMI consumes a high portion of income. Consider reducing liabilities.</div>`;
    else if(stress>20) box.innerHTML+=`<div class="insight">‚ö†Ô∏è EMI load is moderate. Keep monitoring.</div>`;
    else box.innerHTML+=`<div class="insight">‚úÖ EMI level is healthy.</div>`;

    if(d[mode==="Month"?"Budget Used %":"YTD Budget Used %"]>0.9)
      box.innerHTML+=`<div class="insight">üìâ Budget almost exhausted. Slow down discretionary spending.</div>`;

    if(d[mode==="Month"?"Current Month Net Savings":"YTD Net Savings"]<0)
      box.innerHTML+=`<div class="insight">üî¥ Savings are negative. Immediate review recommended.</div>`;
  });
}

load();
</script>

</body>
</html>
